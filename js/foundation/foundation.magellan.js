!function(t,a,e,n){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.2.2",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30},init:function(t,a,e){Foundation.inherit(this,"throttle"),this.bindings(a,e)},events:function(){var e=this,n=e.S,i=e.settings;e.set_expedition_position(),n(e.scope).off(".magellan").on("click.fndtn.magellan","["+e.add_namespace("data-magellan-arrival")+'] a[href^="#"]',function(a){a.preventDefault();var n=t(this).closest("["+e.attr_name()+"]"),i=(n.data("magellan-expedition-init"),this.hash.split("#").join("")),o=t("a[name='"+i+"']");0===o.length&&(o=t("#"+i));var s=o.offset().top;s-=n.outerHeight(),t("html, body").stop().animate({scrollTop:s},700,"swing",function(){history.pushState?history.pushState(null,null,"#"+i):location.hash="#"+i})}).on("scroll.fndtn.magellan",e.throttle(this.check_for_arrivals.bind(this),i.throttle_delay)),t(a).on("resize.fndtn.magellan",e.throttle(this.set_expedition_position.bind(this),i.throttle_delay))},check_for_arrivals:function(){var t=this;t.update_arrivals(),t.update_expedition_positions()},set_expedition_position:function(){var a=this;t("["+this.attr_name()+"=fixed]",a.scope).each(function(e,n){var i,o=t(this),s=o.attr("styles");o.attr("style",""),i=o.offset().top,o.data(a.data_attr("magellan-top-offset"),i),o.attr("style",s)})},update_expedition_positions:function(){var e=this,n=t(a).scrollTop();t("["+this.attr_name()+"=fixed]",e.scope).each(function(){var a=t(this),i=a.data("magellan-top-offset");if(n>=i){var o=a.prev("["+e.add_namespace("data-magellan-expedition-clone")+"]");0===o.length&&((o=a.clone()).removeAttr(e.attr_name()),o.attr(e.add_namespace("data-magellan-expedition-clone"),""),a.before(o)),a.css({position:"fixed",top:0}).addClass("fixed")}else a.prev("["+e.add_namespace("data-magellan-expedition-clone")+"]").remove(),a.attr("style","").removeClass("fixed")})},update_arrivals:function(){var e=this,n=t(a).scrollTop();t("["+this.attr_name()+"]",e.scope).each(function(){var a=t(this),i=i=a.data(e.attr_name(!0)+"-init"),o=e.offsets(a,n),s=a.find("["+e.add_namespace("data-magellan-arrival")+"]"),l=!1;o.each(function(t,n){if(n.viewport_offset>=n.top_offset)return a.find("["+e.add_namespace("data-magellan-arrival")+"]").not(n.arrival).removeClass(i.active_class),n.arrival.addClass(i.active_class),l=!0,!0}),l||s.removeClass(i.active_class)})},offsets:function(a,e){var n=this,i=a.data(n.attr_name(!0)+"-init"),o=e;return a.find("["+n.add_namespace("data-magellan-arrival")+"]").map(function(e,s){var l=t(this).data(n.data_attr("magellan-arrival")),r=t("["+n.add_namespace("data-magellan-destination")+"="+l+"]");if(r.length>0){var d=r.offset().top-i.destination_threshold-a.outerHeight();return{destination:r,arrival:t(this),top_offset:d,viewport_offset:o}}}).sort(function(t,a){return t.top_offset<a.top_offset?-1:t.top_offset>a.top_offset?1:0})},data_attr:function(t){return this.namespace.length>0?this.namespace+"-"+t:t},off:function(){this.S(this.scope).off(".magellan"),this.S(a).off(".magellan")},reflow:function(){var a=this;t("["+a.add_namespace("data-magellan-expedition-clone")+"]",a.scope).remove()}}}(jQuery,window,window.document);